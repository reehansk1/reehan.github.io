<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E-Waste_facility_locator</title>
    <script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?key=AhhJP508d1oIc3u7miSzBXtA5nDTnjQPdanJThl210aoIP_retrqq9CSGJHX-mbu"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Find E-Waste processing Facility Near You</h1>
    <div id="map"></div>
    <script>
        let map;
        let searchManager;

        function loadMapScenario() {
            // Initialize the map
            map = new Microsoft.Maps.Map(document.getElementById('map'), {
                credentials: 'AhhJP508d1oIc3u7miSzBXtA5nDTnjQPdanJThl210aoIP_retrqq9CSGJHX-mbu'
            });

            // Enable geolocation
            navigator.geolocation.getCurrentPosition(function (position) {
                const userLocation = new Microsoft.Maps.Location(
                    position.coords.latitude,
                    position.coords.longitude
                );

                // Set the map view to the user's location
                map.setView({ center: userLocation, zoom: 15 });

                // Create a search manager
                Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
                    searchManager = new Microsoft.Maps.Search.SearchManager(map);
                    searchCoffeeShops(userLocation);
                });
            });
        }

        function searchCoffeeShops(userLocation) {
            const coffeeShopRequest = {
                location: userLocation,
                radius: 50000, // in meters, adjust as needed
                query: 'electronic waste'
            };

            searchManager.search(coffeeShopRequest, function (searchResults) {
                if (searchResults && searchResults.results && searchResults.results.length > 0) {
                    // Clear any existing pins
                    map.entities.clear();

                    // Add pushpins for each coffee shop
                    for (let i = 0; i < searchResults.results.length; i++) {
                        const coffeeShop = searchResults.results[i];
                        const coffeeShopPin = new Microsoft.Maps.Pushpin(coffeeShop.location, {
                            title: coffeeShop.name,
                            subTitle: coffeeShop.address.formattedAddress
                        });
                        map.entities.push(coffeeShopPin);
                    }
                }
            });
        }
    </script>
    <script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario"></script>
</body>
</html>
